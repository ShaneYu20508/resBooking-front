import{p as oe,ba as ne,as as se,g as ue,an as re,bb as de,bc as ie,n as ce,q as ve,bd as me,be as M,r as a,a5 as E,x as fe,A as i,T as pe,C as he,D as ke,F as t,a6 as q,H as Ve,O as Ce,L as r,aw as xe,K as c,N as s,bf as be,M as P,a7 as H,ab as K,a8 as j,ay as G,ai as J}from"./index-7f3591e3.js";import{V as we}from"./VContainer-31b83cef.js";import{V as R,a as f}from"./VRow-0a9a0ff3.js";import{m as ye,b as Q}from"./VSelect-98c0f73e.js";import{V as De}from"./VDataTable-cb5afca6.js";import"./VList-5cc45486.js";import"./ssrBoot-a6f07426.js";import"./VDivider-70911d59.js";const ge=oe({...ne(),...se(ye(),["inline"])},"VCheckbox"),A=ue()({name:"VCheckbox",inheritAttrs:!1,props:ge(),emits:{"update:modelValue":v=>!0,"update:focused":v=>!0},setup(v,T){let{attrs:V,slots:m}=T;const h=re(v,"modelValue"),{isFocused:C,focus:x,blur:n}=de(v),$=ie(),S=ce(()=>v.id||`checkbox-${$}`);return ve(()=>{const[b,w]=me(V),y=M.filterProps(v),D=Q.filterProps(v);return a(M,E({class:["v-checkbox",v.class]},b,y,{modelValue:h.value,"onUpdate:modelValue":g=>h.value=g,id:S.value,focused:C.value,style:v.style}),{...m,default:g=>{let{id:W,messagesId:B,isDisabled:U,isReadonly:F}=g;return a(Q,E(D,{id:W.value,"aria-describedby":B.value,disabled:U.value,readonly:F.value},w,{modelValue:h.value,"onUpdate:modelValue":O=>h.value=O,onFocus:x,onBlur:n}),m)}})}),{}}}),ze={__name:"ReservationsView",setup(v){const{apiAuth:T}=Ce(),V=fe(),m=i([]),h=i([]),C=i(!1),x=i(!1),n=i(null),$=new Date().toLocaleDateString("sv-SE"),S=i($),b=i(!1),w=i(!1),y=i(!1),D=i(!1),g=i(0),W=i(0),B=[{title:"姓名",key:"name",minWidth:"100px"},{title:"電話",key:"phone",minWidth:"120px"},{title:"用餐人數",key:"peopleCount",minWidth:"70px"},{title:"用餐日期",key:"reservationDate",minWidth:"140px"},{title:"時段",key:"timePeriod",minWidth:"70px"},{title:"時間",key:"reservationTime",minWidth:"80px"},{title:"報到狀態",key:"checkIn",minWidth:"100px"},{title:"顧客未到",key:"noShow",minWidth:"100px"}],U=o=>new Date(o).toLocaleDateString("zh-TW"),F=o=>{o.checkIn||(n.value=o,C.value=!0)},O=o=>{n.value=o,x.value=!0},X=async()=>{const o=n.value;if(!(!o||o.checkIn))try{const{data:l}=await T.patch(`/reservations/${o._id}/checkIn`,{checkIn:!0});o.checkIn=l.result.checkIn;const e=m.value.findIndex(d=>d._id===o._id);e!==-1&&(m.value[e].checkIn=o.checkIn),V({text:"已標記為已報到",snackbarProps:{color:"green"}}),C.value=!1,k()}catch{V({text:"更新報到狀態失敗",snackbarProps:{color:"red"}})}},Y=async()=>{const o=n.value;if(o)try{const{data:l}=await T.patch(`/reservations/${o._id}/noShow`,{noShow:!0});o.noShow=l.result.noShow;const e=m.value.findIndex(d=>d._id===o._id);e!==-1&&(m.value[e].noShow=o.noShow),V({text:"已取消訂位並標記為未到",snackbarProps:{color:"green"}}),x.value=!1,k()}catch{V({text:"取消訂位失敗",snackbarProps:{color:"red"}})}},k=()=>{const o=S.value,l=b.value,e=w.value,d=y.value,p=D.value,I=m.value.filter(u=>{const N=new Date(u.reservationDate).toLocaleDateString("zh-TW"),te=o?N===new Date(o).toLocaleDateString("zh-TW"):!0;let L=!0;(l||e)&&(l&&e||l&&!u.checkIn||e&&u.checkIn?L=!0:L=!1);let z=!0;return(d||p)&&(d&&p||d&&u.timePeriod==="中午"||p&&u.timePeriod==="晚上"?z=!0:z=!1),te&&L&&z});h.value=I,g.value=0,W.value=0;const _=new Date(S.value).toLocaleDateString("zh-TW");for(const u of m.value)new Date(u.reservationDate).toLocaleDateString("zh-TW")===_&&(u.timePeriod==="中午"?g.value+=u.peopleCount:u.timePeriod==="晚上"&&(W.value+=u.peopleCount))},Z=()=>{b.value&&(w.value=!1),k()},ee=()=>{w.value&&(b.value=!1),k()},le=()=>{y.value&&(D.value=!1),k()},ae=()=>{D.value&&(y.value=!1),k()};return pe(async()=>{try{const{data:o}=await T.get("/reservations");m.value=o.result,h.value=o.result,k()}catch{V({text:"無法取得訂位資料",snackbarProps:{color:"red"}})}}),(o,l)=>(he(),ke(Ve,null,[a(we,null,{default:t(()=>[a(R,null,{default:t(()=>[a(f,{cols:"12"},{default:t(()=>l[9]||(l[9]=[r("h1",null,"訂位紀錄管理",-1)])),_:1,__:[9]}),a(f,{cols:"12",sm:"12",md:"3"},{default:t(()=>[a(xe,{modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=e=>S.value=e),label:"篩選日期",type:"date",onChange:k},null,8,["modelValue"])]),_:1}),a(f,{cols:"2",sm:"2",md:"1"},{default:t(()=>[a(A,{modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=e=>y.value=e),label:"中午",onChange:le},null,8,["modelValue"])]),_:1}),a(f,{cols:"2",sm:"2",md:"1"},{default:t(()=>[a(A,{modelValue:D.value,"onUpdate:modelValue":l[2]||(l[2]=e=>D.value=e),label:"晚上",onChange:ae},null,8,["modelValue"])]),_:1}),a(f,{cols:"4",sm:"4",md:"2"},{default:t(()=>[a(A,{modelValue:b.value,"onUpdate:modelValue":l[3]||(l[3]=e=>b.value=e),label:"僅顯示未報到",onChange:Z},null,8,["modelValue"])]),_:1}),a(f,{cols:"4",sm:"4",md:"2"},{default:t(()=>[a(A,{modelValue:w.value,"onUpdate:modelValue":l[4]||(l[4]=e=>w.value=e),label:"僅顯示已報到",onChange:ee},null,8,["modelValue"])]),_:1})]),_:1}),a(R,null,{default:t(()=>[a(f,{cols:"6"},{default:t(()=>[c("中午總訂位人數："+s(g.value),1)]),_:1}),a(f,{class:"text-red",cols:"6"},{default:t(()=>l[10]||(l[10]=[c("標記號碼有未到紀錄，請致電提醒")])),_:1,__:[10]})]),_:1}),a(R,null,{default:t(()=>[a(f,{cols:"6"},{default:t(()=>[c("晚上總訂位人數："+s(W.value),1)]),_:1}),a(f,{cols:"12"},{default:t(()=>[a(De,{items:h.value,headers:B,"item-value":"_id","item-key":"_id"},{"item.phone":t(({item:e})=>[r("span",{class:be({"text-red":e.isWatched})},s(e.phone),3)]),"item.reservationDate":t(({item:e})=>[c(s(U(e.reservationDate)),1)]),"item.checkIn":t(({item:e})=>[a(P,{color:e.noShow?"red":e.checkIn?"success":"grey",size:"small",disabled:e.noShow||e.checkIn,onClick:d=>F(e)},{default:t(()=>[c(s(e.noShow?"已取消訂位":e.checkIn?"已入座":"報到"),1)]),_:2},1032,["color","disabled","onClick"])]),"item.noShow":t(({item:e})=>[a(P,{color:e.checkIn?"success":e.noShow?"red":"grey",size:"small",disabled:e.noShow||e.checkIn,onClick:d=>O(e)},{default:t(()=>[c(s(e.checkIn?"顧客已報到":e.noShow?"顧客未到":"登記為未到"),1)]),_:2},1032,["color","disabled","onClick"])]),_:2},1032,["items"])]),_:1})]),_:1})]),_:1}),a(q,{modelValue:C.value,"onUpdate:modelValue":l[6]||(l[6]=e=>C.value=e),"max-width":"400px"},{default:t(()=>[a(H,null,{default:t(()=>[a(K,null,{default:t(()=>l[11]||(l[11]=[c("報到確認")])),_:1,__:[11]}),a(j,null,{default:t(()=>{var e,d,p,I,_,u;return[l[12]||(l[12]=r("p",null,"請確認以下資訊是否正確：",-1)),r("p",null," 姓名： "+s((e=n.value)==null?void 0:e.name),1),r("p",null," 電話： "+s((d=n.value)==null?void 0:d.phone),1),r("p",null," 人數： "+s((p=n.value)==null?void 0:p.peopleCount),1),r("p",null," 日期： "+s(U((I=n.value)==null?void 0:I.reservationDate)),1),r("p",null," 時段： "+s((_=n.value)==null?void 0:_.timePeriod),1),r("p",null," 時間： "+s((u=n.value)==null?void 0:u.reservationTime),1)]}),_:1,__:[12]}),a(G,null,{default:t(()=>[a(J),a(P,{text:"",onClick:l[5]||(l[5]=e=>C.value=!1)},{default:t(()=>l[13]||(l[13]=[c("取消")])),_:1,__:[13]}),a(P,{color:"green",onClick:X},{default:t(()=>l[14]||(l[14]=[c("確認報到")])),_:1,__:[14]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(q,{modelValue:x.value,"onUpdate:modelValue":l[8]||(l[8]=e=>x.value=e),"max-width":"400"},{default:t(()=>[a(H,null,{default:t(()=>[a(K,{class:"text-h6",style:{"font-weight":"bold"}},{default:t(()=>l[15]||(l[15]=[c("登記為未到嗎?")])),_:1,__:[15]}),a(j,null,{default:t(()=>{var e,d,p,I,_,u;return[l[16]||(l[16]=r("p",null," 確定要取消該訂位並列入觀察名單嗎？",-1)),r("p",null," 姓名： "+s((e=n.value)==null?void 0:e.name),1),r("p",null," 電話： "+s((d=n.value)==null?void 0:d.phone),1),r("p",null," 人數： "+s((p=n.value)==null?void 0:p.peopleCount),1),r("p",null," 日期： "+s(U((I=n.value)==null?void 0:I.reservationDate)),1),r("p",null," 時段： "+s((_=n.value)==null?void 0:_.timePeriod),1),r("p",null," 時間： "+s((u=n.value)==null?void 0:u.reservationTime),1)]}),_:1,__:[16]}),a(G,null,{default:t(()=>[a(J),a(P,{text:"",onClick:l[7]||(l[7]=e=>x.value=!1)},{default:t(()=>l[17]||(l[17]=[c("關閉")])),_:1,__:[17]}),a(P,{color:"red",onClick:Y},{default:t(()=>l[18]||(l[18]=[c("確定")])),_:1,__:[18]})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ze as default};
